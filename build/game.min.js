function RoomTest(){room=Room.extend({}),room.init(20,20,{top:null,bottom:"door",left:"hidden",right:"door"}),room.log()}var Game={nextId:0,pieces:[],el:document.getElementById("room"),add:function(e){e.create(),null===e.id?(e.id=this.nextId,this.pieces[this.nextId]=e,this.nextId++):this.pieces[e.id]=e,this.show(e)},addAll:function(e){for(var t=0,i=e.length;i>t;t++)this.add(e[t])},remove:function(e){this.el.removeChild(e.el),delete this.pieces[e.id]},hide:function(e){this.el.removeChild(e.el)},show:function(e){this.el.appendChild(this.pieces[e.id].el)},step:function(){for(var e=0,t=this.pieces.length;t>e;e++)this.pieces[e].step()}},TextBox={el:document.getElementById("text"),last:null,push:function(e){var t=document.createElement("div");t.innerHTML=e,t.className="mess",this.el.insertBefore(t,this.last),this.last=t}};TextBox.push('Wellcome to jarl <br> push "?" for instructions'),TextBox.push("You entered level 1");var Extendable={extend:function(e){var t=Object.create(this);for(var i in e)t[i]=e[i];return"construct"in t&&t.construct(),t}},Gamepiece=Extendable.extend({x:0,y:0,id:null,className:"fixed trans",create:function(){this.el=document.createElement("img"),this.el.className=this.className,this.el.src=this.src,this.step()},step:function(){var e=this.fliped?" fliped":"";this.el.style.left=this.x+"px",this.el.style.top=this.y+"px",this.el.className=this.className+e},move:function(e,t){this.x=e,this.y=t,this.step()},moveRel:function(e,t){this.x+=e,this.y+=t,this.step()}}),Player=Gamepiece.extend({type:"player",src:"night.min.gif"});Game.add(Player);var Wall=Gamepiece.extend({src:"wall.min.gif"}),Door=Gamepiece.extend({src:"doorClosed.min.gif"}),Room=Extendable.extend({init:function(e,t,i){this.x=0,this.y=0,this.height=e,this.width=t,this.grid=[];for(var o=0;t>o;o++){this.grid[o]=[];for(var n=0;e>n;n++)this.grid[o][n]=null}this.doorObj=i,this.createWalls()},createWalls:function(){this.createHozWall(0,this.doorObj.top),this.createHozWall(this.height-1,this.doorObj.bottom),this.createVertWall(0,this.doorObj.left),this.createVertWall(this.width-1,this.doorObj.right)},addObj:function(e){e.currentRoom(this)},checkSpot:function(e,t){this.grid[e][t]},createVertWall:function(e,t){for(var i=this.height;i--;)this.grid[e][i]="wall";null!==t&&(this.grid[e][Math.floor(this.height/2)]=t)},createHozWall:function(e,t){for(var i=this.width;i--;)this.grid[i][e]="wall";null!==t&&(this.grid[Math.floor(this.width/2)][e]=t)},create:function(){this.el=document.createElement("canvas")},log:function(){for(var e="",t=0;t<this.width;t++){for(var i="",o=0;o<this.height;o++){var n,r=this.grid[t][o];switch(r){case"wall":n="w";break;case"door":n="d";break;case"hidden":n="h";break;case null:n=".";break;default:n="?"}i+=n}e+=i+"\n"}console.log(e)},apply:function(){}}),LevelGen=Extendable.extend({depth:5,branchChanse:.5,begin:function(){var e=Room.extend({type:"begining",depth:this.depth}),t={placement:"bottom",ref:e},i=this.roomGen(t,!0),o=Door.extend({ref:i}),n=Math.floor(50*Math.random())+5,r=Math.floor(50*Math.random())+5;return e.init(n,r,{top:Door.extend({ref:o})}),e},roomGen:function(e,t){var i={up:null,down:null,left:null,right:null},o=Room.extend({depth:e.ref.depth-1,isRightPath:t,type:"random"});console.log("generate room at depth: ",e.ref.depth),i[e.ref.placement]=Door.extend({ref:e.ref});var n=["up","down","left","right"];if(e.ref.depth>1){if(t){for(var r=Math.floor(4*Math.random());null!==i[n[r]];)r=Math.floor(4*Math.random());i[n[r]]=Door.extend({ref:this.roomGen({placement:n[(r+2)%4],ref:o},!0)})}for(wayName in i){var s=Math.random()>.5;s&&null===i[wayName]&&(i[wayName]=Door.extend({ref:this.roomGen({placement:n[(n.indexOf(wayName)+2)%4],ref:o},!1)}))}}else t&&(o.type="end");var l=Math.floor(50*Math.random())+5,a=Math.floor(50*Math.random())+5;return o.init(a,l,i),o}}),firstRoom=LevelGen.begin();firstRoom.log();